<template>
  <div class="lazy-loading">
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
    <div class="img-box">
      <img src="../assets/images/loading.gif" data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=596930597,526197840&fm=26&gp=0.jpg" alt="">
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      // 指示器，表示图片显示的数量
      cursor: 0,
      // 定时器
      timer: "",
    };
  },
  mounted() {
    let oImgs = document.querySelectorAll(".img-box");
    let innerHeight=window.innerHeight;
    // 初始化页面时
    this.lazy(innerHeight, oImgs, oImgs.length);
    // 监听浏览器滚动事件
    window.onscroll = () => {
      if (this.cursor === length) return;
      if (this.timer) clearTimeout(this.timer);
      this.timer = setTimeout(() => {
        this.lazy(innerHeight, oImgs, oImgs.length);
      }, 300);
    };
  },
  methods: {
    /**
     * @description 懒加载图片
     * @method lazy
     * @params {Number,Array对象}  浏览器可视区域的高度 图片数组
     */
    lazy(h, imgs, length) {
      let s = document.documentElement.scrollTop; // 滚动的距离
      for (let i = this.cursor; i < length; i++) {
        // 图片出现在可视区域时，显示图片
        if (h + s > imgs[i].offsetTop) {
          this.cursor++;
          imgs[i].children[0].src = imgs[i].children[0].dataset.src;
        }
      }
    },
  },
};
</script>

<style lang="scss" scoped>
.img-box {
  min-height: 300px;
  img {
    width: 100%;
  }
}
</style>